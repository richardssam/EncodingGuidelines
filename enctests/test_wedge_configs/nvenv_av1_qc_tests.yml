test_nvenc:
    name: test_nvenc_av1_quality
    description: variations of nvenc_av1_quality
    app: ffmpeg
    suffix: .mp4
    encoding_template: '{ffmpeg_bin} {input_args} -colorspace bt709 -i "{source}" -vframes {duration} {encoding_args} -y "{outfile}"'
    sources:
    - sources/enc_sources/chimera_cars_srgb/chimera_cars_srgb.%05d.png.yml
    - sources/enc_sources/chimera_coaster_srgb/chimera_coaster_srgb.%06d.png.yml
    - sources/enc_sources/chimera_fountains_srgb/chimera_fountains_srgb.%05d.png.yml
    - sources/hdr_sources/sparks_srgb/sparks_srgb.%05d.png.yml
    wedges:
        av1_nvenc_cq00: &base_args
            -c:v: av1_nvenc
            -preset: medium
            -rc: vbr
            -tune: hq
            -cq: 0
            -pix_fmt: yuv420p
            -vf: '"scale=in_range=full:in_color_matrix=bt709:out_range=tv:out_color_matrix=bt709"'
            -color_range: tv
            -colorspace: bt709
            -color_primaries: bt709
            -color_trc: bt709 

        av1_nvenc_cq05:
             << : *base_args
             -cq: 5

        av1_nvenc_cq10:
             << : *base_args
             -cq: 10
             
        av1_nvenc_cq15:
             << : *base_args
             -cq: 15

        av1_nvenc_cq20:
             << : *base_args
             -cq: 20
             
        av1_nvenc_cq25:
             << : *base_args
             -cq: 25

        av1_nvenc_cq30:
             << : *base_args
             -cq: 30

        av1_nvenc_cq40:
             << : *base_args
             -cq: 40

        av1_nvenc_cq49:
             << : *base_args
             -cq: 49
        
---

reports:
    graphs:
    - args:
        color: media
        height: 400
        x: -cq
        y: psnr_y_harmonic_mean
        markers: True
      name: psnr_y_harmonic_mean.png
      sortby: name
    - args:
        color: media
        height: 400
        x: -cq
        y: vmaf_harmonic_mean
        markers: True
      name: vmaf_harmonic_mean.png
      sortby: name
    - args:
        color: media
        height: 400
        x: -cq
        y: encode_time
        markers: True
      name: encode_time.png
      sortby: name
    - args:
        color: media
        height: 400
        x: -cq
        y: filesize
        markers: True
      name: filesize.png
      sortby: name
    name: nvenc-qc
    title: Linux nvenc av1 Comparison
    description: This is a comparison of av1 nvenc encoding.
    directory: nvenc-av1-qc-encode
    templatefile: basicmovie.html.jinja

